parameters:
  - name: mode
    displayName: 'Which template to use ?'
    type: string
    default: jmeter

variables:
  scale_down_replicas: 0
  scale_up_replicas_master: 1
  service: jmeter-slaves
  service-master: jmeter-master
  armModulePath: $(System.DefaultWorkingDirectory)/pipelines/azure/arm
  k8conn: k8_$(Build.BuildID)
  ${{ if not(eq(parameters.mode,'tests')) }}:
    report_dir: kubernetes/tmp/report
    results: kubernetes/tmp/results.csv
    log: kubernetes/tmp/jmeter.log
    errors: kubernetes/tmp/errors.xml
    reposRoot: repos

  ${{ if eq(parameters.mode,'tests') }}:
    ${{ if ne(False,variables['crux_clone']) }}:
      crux_clone: true
    tests_clone: true
    prepare_tests: true
    create_cluster: false
    configure_cluster: false
    deploy_to_cluster: false
    delete_cluster: false
    jmeter_tests: true
    archive_jmeter_report: true
    archive_results_file: true
    archive_log: true
    archive_errors: true
    evaluate_as_junit_tests: true
    publish_junit_results: true
    #changing paths for mock to avoid clash with real tests
    mock_dir: mocked/kubernetes/tmp
    report_dir: $(mock_dir)/report
    results: $(mock_dir)/results.csv
    log: $(mock_dir)/jmeter.log
    errors: $(mock_dir)/errors.xml
    thresholds_file: $(mock_dir)/thresholds.properties
    reposRoot: ""


  ${{ if eq(parameters.mode,'jmeter') }}:
    crux_clone: true
    tests_clone: true
    prepare_tests: true
    create_cluster: false
    configure_cluster: true
    deploy_to_cluster: true
    delete_cluster: false
    jmeter_tests: true
    archive_jmeter_report: true
    archive_results_file: true
    archive_log: true
    archive_errors: true
    evaluate_as_junit_tests: true
    publish_junit_results: true

  ${{ if eq(parameters.mode,'jmeter_dynamic') }}:
    crux_clone: true
    tests_clone: true
    prepare_tests: true
    create_cluster: true
    configure_cluster: false
    deploy_to_cluster: true
    delete_cluster: true
    jmeter_tests: true
    archive_jmeter_report: true
    archive_results_file: true
    archive_log: true
    archive_errors: true
    evaluate_as_junit_tests: true
    publish_junit_results: true
